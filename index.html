<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%E2%9C%A8%3C/text%3E%3C/svg%3E">
    <title>RCA ã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ»ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ (Insight Companion)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #F8FAFC;
            color: #334155;
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 300px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 500px; 
            }
        }

        .rca-table, .action-table, .initiative-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .rca-table th, .action-table th, .initiative-table th {
            color: white;
            padding: 10px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        .rca-table th { background-color: #F59E0B; }
        .action-table th { background-color: #0EA5E9; }
        .initiative-table th { background-color: #7C3AED; }
        .rca-table td, .action-table td, .initiative-table td {
            border: 1px solid #e2e8f0;
            padding: 10px;
            vertical-align: top;
        }
        tr:nth-child(even) { background-color: #f8fafc; }

        .fishbone-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        @media (min-width: 768px) {
            .fishbone-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .fishbone-card {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .fishbone-header {
            font-weight: bold;
            color: #475569;
            border-bottom: 2px solid #cbd5e1;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .why-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            position: relative;
        }
        .why-number {
            background-color: #EC4899; 
            color: white;
            font-weight: bold;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.75rem;
            margin-right: 0.75rem;
            flex-shrink: 0;
            z-index: 10;
        }
        .why-line {
            position: absolute;
            left: 11px;
            top: 24px;
            bottom: -10px;
            width: 2px;
            background-color: #FBCFE8; 
            z-index: 0;
        }
        .why-step:last-child .why-line {
            display: none;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #0EA5E9;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-slate-50">
    <header class="relative w-full h-64 bg-gradient-to-r from-slate-800 to-slate-900 shadow-xl overflow-hidden mb-8 flex items-center justify-center">
      <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
        <div class="absolute top-10 left-10 w-64 h-64 bg-teal-500 rounded-full filter blur-3xl"></div>
        <div class="absolute bottom-10 right-10 w-64 h-64 bg-blue-500 rounded-full filter blur-3xl"></div>
      </div>
    
      <div class="relative z-10 text-center px-4 md:px-20 mt-4">
        <h1 class="text-white font-bold text-xs md:text-sm lg:text-base leading-relaxed tracking-wide shadow-black drop-shadow-md">
          è³ªã®æ ¼å·®ã‚’åŸ‹ã‚ã‚‹ï¼šã‚¢ã‚¸ã‚¢6ã‹å›½ã®åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹AIæ´»ç”¨RCAãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã®è©•ä¾¡<br>
          <span class="text-slate-300 font-medium">â€“ ã‚¿ã‚¤ã€å°æ¹¾ã€ãƒŸãƒ£ãƒ³ãƒãƒ¼ã€ãƒãƒ¬ãƒ¼ã‚·ã‚¢ã€ãƒ–ãƒ«ãƒã‚¤ã€ãƒ•ã‚£ãƒªãƒ”ãƒ³ã®å…±åŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â€“</span>
        </h1>
      </div>
    
      <div class="absolute top-6 right-6 flex items-center gap-4 z-20">            
        <div class="flex gap-2">
        <a href="https://rca-th.onrender.com/" target="_blank" rel="noopener noreferrer" title="ã‚¿ã‚¤ã®ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã">
          <img src="https://flagcdn.com/h40/th.png" alt="Thailand" class="h-6 rounded shadow-lg opacity-90 hover:opacity-100 hover:scale-110 transition-transform duration-200">
        </a>    
          <img src="https://flagcdn.com/h40/tw.png" alt="Taiwan" title="Taiwan" class="h-6 rounded shadow-lg opacity-90 hover:opacity-100 hover:scale-110 transition-transform duration-200">
          <img src="https://flagcdn.com/h40/mm.png" alt="Myanmar" title="Myanmar" class="h-6 rounded shadow-lg opacity-90 hover:opacity-100 hover:scale-110 transition-transform duration-200">
          <img src="https://flagcdn.com/h40/ph.png" alt="Philippines" title="Philippines" class="h-6 rounded shadow-lg opacity-90 hover:opacity-100 hover:scale-110 transition-transform duration-200">
          <img src="https://flagcdn.com/h40/my.png" alt="Malaysia" title="Malaysia" class="h-6 rounded shadow-lg opacity-90 hover:opacity-100 hover:scale-110 transition-transform duration-200">
          <img src="https://flagcdn.com/h40/bn.png" alt="Brunei" title="Brunei" class="h-6 rounded shadow-lg opacity-90 hover:opacity-100 hover:scale-110 transition-transform duration-200">
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 -mt-20 pb-16 space-y-24 max-w-screen-2xl relative z-20">

        <section id="ai-lab">
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 rounded-3xl p-1 shadow-2xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
                <div class="bg-white rounded-[20px] p-6 md:p-10">
                    <div class="text-center mb-10">
                        <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ã‚µãƒãƒ¼ãƒˆ</span>
                        <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800 mt-4 mb-2 flex items-center justify-center gap-3">
                            <span>âœ¨</span> RCA ã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ»ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³
                        </h2>
                        <p class="text-slate-500 max-w-2xl mx-auto">
                            æ·±ã„å­¦ç¿’ã€æ ¹æœ¬åŸå› åˆ†æã€ãã—ã¦ã‚ˆã‚Šå®‰å…¨ãªã‚·ã‚¹ãƒ†ãƒ ã®å…±å‰µã‚’æ”¯æ´ã™ã‚‹å°‚é–€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€‚
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">

                        <div class="space-y-6">
                            <div class="bg-slate-50 rounded-2xl p-6 border border-slate-200 shadow-sm hover:shadow-md transition duration-300">
                                <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">ğŸ¥</span> 1. ç—…é™¢ãƒªã‚¹ã‚¯ãƒ»ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Š
                                </h3>
                                <p class="text-xs text-slate-500 mb-3">äº‹è±¡ã®çµŒéã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚æ ¹æœ¬åŸå› ã®å¯è¦–åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
                                <textarea id="scenarioInput" class="w-full p-4 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-amber-500 outline-none transition shadow-inner mb-4 bg-white" rows="6" placeholder="ä¾‹ï¼šåŒ…è£…ã®é¡ä¼¼ã¨éåº¦ãªæ¥­å‹™é‡ã«ã‚ˆã‚Šã€çœ‹è­·å¸«ãŒèª¤ã£ãŸè–¬å‰¤ã‚’æŠ•ä¸ã—ãŸ..."></textarea>
                                
                                <button id="combinedRunButton" onclick="startFullAnalysis()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition shadow-lg hover:shadow-green-500/30 flex justify-center items-center gap-2 transform active:scale-95">
                                    <span id="runSpinner" class="loader hidden border-white border-t-green-800"></span>
                                    <span>ğŸ” æ ¹æœ¬åŸå› åˆ†æ (RCA) ã‚’å®Ÿè¡Œ</span>
                                </button>

                                <div class="mt-4 rounded-xl border border-amber-100 bg-white shadow-inner overflow-hidden">
                                  <div id="analyzeResult" class="hidden p-4 text-sm text-slate-700 overflow-x-auto"></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 rounded-2xl p-6 border-2 border-blue-100 shadow-md relative overflow-hidden h-full">
                            <div class="absolute top-0 right-0 bg-blue-200 text-blue-800 text-[10px] font-bold px-2 py-1 rounded-bl-lg">ã‚¹ãƒ†ãƒƒãƒ— 2 (è‡ªå‹•ç”Ÿæˆ)</div>
                            <h3 class="text-lg font-bold text-blue-900 mb-3 flex items-center gap-2">
                                <span class="text-2xl">ğŸ¯</span> 2. ãƒªã‚¹ã‚¯åˆ†æã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
                            </h3>
                            <p class="text-xs text-blue-700 mb-4">PDSAã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã€æ”¹å–„ç­–ã€ãŠã‚ˆã³çµè«–ãƒ»æè¨€ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</p>
                            <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ï¼š</label>
                            <textarea id="planInput" class="w-full p-4 border border-blue-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none h-24 bg-white mb-4 shadow-inner font-mono text-slate-600" placeholder="åˆ†æçµæœã‚’å¾…æ©Ÿä¸­..."></textarea>
                            <div class="flex gap-2">
                                <button onclick="exportToWord()" class="w-full bg-white hover:bg-slate-50 text-blue-700 border border-blue-200 font-bold py-3 px-4 rounded-xl transition shadow-md flex justify-center items-center gap-2 transform active:scale-95" title="Wordå‡ºåŠ›">
                                    <span class="text-lg">ğŸ“„</span>
                                    <span class="md:inline">Wordãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‡ºåŠ›</span>
                                </button>
                            </div>

                            <div class="mt-6 rounded-xl border border-blue-100 bg-white shadow-lg overflow-hidden">
                              <div id="planResult" class="hidden p-5 text-sm text-slate-700 min-h-[100px] overflow-x-auto"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
            <div class="mt-20 flex items-center justify-center">
                <div class="h-px w-24 bg-slate-300"></div>
                <span class="px-4 text-slate-400 text-sm font-semibold tracking-wider uppercase">ãƒŠãƒ¬ãƒƒã‚¸ãƒ»ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ€ã‚¤ãƒ–</span>
                <div class="h-px w-24 bg-slate-300"></div>
            </div>
        </section>

        <section>
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-800">1. ã‚³ã‚¢ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®è©³ç´°è§£èª¬</h2>
                <div class="h-1 w-20 bg-teal-500 mx-auto mt-4 rounded-full"></div>
                <p class="text-slate-600 mt-4 max-w-3xl mx-auto">
                    åŒ»ç™‚å®‰å…¨ã®6ã¤ã®æŸ±ã‚’ç†è§£ã—ã€å€‹äººã‚’è²¬ã‚ã‚‹ã®ã§ã¯ãªãã€äº‹æ•…ãŒã€Œã©ã®ã‚ˆã†ã«ç™ºç”Ÿã—ã€ã€Œã©ã†äºˆé˜²ã§ãã‚‹ã‹ã€ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">

                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-cyan-500 hover:shadow-xl transition group">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-4xl">ğŸŸ</span>
                        <h3 class="font-bold text-2xl text-slate-800">1. é­šéª¨å›³ (çŸ³å·å›³)</h3>
                    </div>
                    <p class="text-slate-600 leading-relaxed mb-6">
                        <strong>çŸ³å·é¦¨åšå£« (Dr. Kaoru Ishikawa)</strong> ãŒé–‹ç™ºã—ãŸRCAãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢åˆ†é‡ã§ã¯ <strong>6M</strong> ã«æ³¨ç›®ã—ã¾ã™ã€‚
                    </p>
                    
                    <div class="w-full overflow-hidden bg-slate-50 rounded-xl border border-slate-200 p-2 mb-4 flex justify-center">
                        <svg viewBox="0 0 800 350" class="w-full h-auto drop-shadow-sm">
                            <line x1="50" y1="175" x2="650" y2="175" stroke="#334155" stroke-width="4" />
                            <polygon points="650,130 790,175 650,220" fill="#0EA5E9" />
                            <text x="705" y="172" font-family="sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">å•é¡Œ</text>
                            <text x="705" y="195" font-family="sans-serif" font-size="12" fill="#E0F2FE" text-anchor="middle">(çµæœ)</text>
                            <line x1="150" y1="50" x2="200" y2="175" stroke="#64748B" stroke-width="2" />
                            <rect x="100" y="20" width="100" height="30" rx="5" fill="white" stroke="#64748B" />
                            <text x="150" y="40" font-family="sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">äºº (Man)</text>
                            <line x1="350" y1="50" x2="400" y2="175" stroke="#64748B" stroke-width="2" />
                            <rect x="300" y="20" width="100" height="30" rx="5" fill="white" stroke="#64748B" />
                            <text x="350" y="40" font-family="sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">æ©Ÿ (Machine)</text>
                            <line x1="550" y1="50" x2="600" y2="175" stroke="#64748B" stroke-width="2" />
                            <rect x="500" y="20" width="100" height="30" rx="5" fill="white" stroke="#64748B" />
                            <text x="550" y="40" font-family="sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">æ³• (Method)</text>
                            <line x1="150" y1="300" x2="200" y2="175" stroke="#64748B" stroke-width="2" />
                            <rect x="100" y="300" width="100" height="30" rx="5" fill="white" stroke="#64748B" />
                            <text x="150" y="320" font-family="sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">æ–™ (Material)</text>
                            <line x1="450" y1="300" x2="500" y2="175" stroke="#64748B" stroke-width="2" />
                            <rect x="400" y="300" width="120" height="30" rx="5" fill="white" stroke="#64748B" />
                            <text x="460" y="320" font-family="sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">ç’° (Environment)</text>
                        </svg>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs text-slate-600 bg-cyan-50 p-4 rounded-xl border border-cyan-100">
                        <div><strong class="text-cyan-800">1. äºº (Man):</strong> èƒ½åŠ›ã€ç–²åŠ´ã€ã‚¹ãƒˆãƒ¬ã‚¹ã€é…ç½®ã€æ•™è‚²ã€‚</div>
                        <div><strong class="text-cyan-800">2. æ©Ÿ (Machine):</strong> è£…ç½®æ•…éšœã€æ ¡æ­£ã€ä¿å®ˆã€è¨­è¨ˆã€‚</div>
                        <div><strong class="text-cyan-800">3. æ³• (Method):</strong> ä¸æ˜ç­ãªSOPã€å¤ã„æŒ‡é‡ã€é€šä¿¡æ‰‹é †ã€‚</div>
                        <div><strong class="text-cyan-800">4. æ–™ (Material):</strong> è–¬å‰¤æ¬ é™¥ã€åŒ…è£…é¡ä¼¼ã€æ¶ˆè€—å“å“è³ªã€‚</div>
                        <div><strong class="text-cyan-800">5. ç’° (Environment):</strong> é¨’éŸ³ã€ç…§æ˜ã€é…ç½®ã€å‰²ã‚Šè¾¼ã¿ã€‚</div>
                        <div><strong class="text-cyan-800">6. æ¸¬ (Measurement):</strong> ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§ã€æ¤œæŸ»å€¤ã®è§£é‡ˆã€‚</div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-pink-500 hover:shadow-xl transition group">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-4xl">â“</span>
                        <h3 class="font-bold text-2xl text-slate-800">2. ãªãœãªãœåˆ†æ (5 Whys)</h3>
                    </div>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong>è±Šç”°ä½å‰ (Sakichi Toyoda)</strong> ãŒè€ƒæ¡ˆã€‚5å›ã®ã€Œãªãœã€ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§ã€çœŸã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã—ã¾ã™ã€‚
                    </p>
                    <div class="bg-pink-50 p-4 rounded-lg border border-pink-100">
                        <strong class="text-pink-800 block mb-2 text-sm">ä¾‹ï¼šæ‚£è€…ã®è»¢å€’</strong>
                        <div class="space-y-0">
                            <div class="why-step"><div class="why-number">1</div><div class="why-line"></div><div class="text-sm text-slate-700 pt-1">ãªãœï¼ŸåºŠãŒæ¿¡ã‚Œã¦ã„ãŸã€‚</div></div>
                            <div class="why-step"><div class="why-number">2</div><div class="why-line"></div><div class="text-sm text-slate-700 pt-1">ãªãœï¼Ÿé…ç®¡ã‹ã‚‰æ°´ãŒæ¼ã‚Œã¦ã„ãŸã€‚</div></div>
                            <div class="why-step"><div class="why-number">3</div><div class="why-line"></div><div class="text-sm text-slate-700 pt-1">ãªãœï¼Ÿãƒ‘ãƒƒã‚­ãƒ³ãŒç ´æã—ã¦ã„ãŸã€‚</div></div>
                            <div class="why-step"><div class="why-number">4</div><div class="why-line"></div><div class="text-sm text-slate-700 pt-1">ãªãœï¼Ÿå®‰ä¾¡ãªãƒ‘ãƒƒã‚­ãƒ³ã‚’è³¼å…¥ã—ãŸã€‚</div></div>
                            <div class="why-step"><div class="why-number">5</div><div class="text-sm text-slate-700 pt-1 font-bold text-pink-700">æ ¹æœ¬åŸå› ï¼šå“è³ªã‚ˆã‚Šä¾¡æ ¼ã‚’å„ªå…ˆã—ãŸèª¿é”æ–¹é‡ã€‚</div></div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-green-600 hover:shadow-xl transition group">
                  <div class="flex items-center gap-3 mb-4">
                    <span class="text-4xl">ğŸ„</span>
                    <h3 class="font-bold text-2xl text-slate-800">3. ãƒ•ã‚©ãƒ«ãƒˆãƒ„ãƒªãƒ¼åˆ†æ (FTA)</h3>
                  </div>
                  <p class="text-xs text-slate-500 mb-3">æ•…éšœçµŒè·¯ã®è¦–è¦šåŒ–</p>
                  <div class="bg-green-50 p-6 rounded-xl border border-green-200 flex flex-col items-center overflow-x-auto">
                    <div class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold text-sm shadow-md z-10 text-center">é ‚ä¸Šäº‹è±¡ (äº‹æ•…)</div>
                    <div class="h-6 w-0.5 bg-slate-400"></div>
                    <div class="bg-slate-800 text-white text-[10px] px-2 py-0.5 rounded z-10 relative">ORã‚²ãƒ¼ãƒˆ</div>
                    <div class="h-4 w-0.5 bg-slate-400"></div>
                    <div class="w-64 h-0.5 bg-slate-400"></div>
                    <div class="flex justify-between w-full max-w-md gap-4">
                      <div class="flex flex-col items-center w-1/2">
                        <div class="h-4 w-0.5 bg-slate-400"></div>
                        <div class="bg-white border-2 border-green-500 text-green-800 px-3 py-2 rounded-lg text-xs font-bold shadow-sm text-center">ç›´æ¥åŸå›  A</div>
                      </div>
                      <div class="flex flex-col items-center w-1/2">
                        <div class="h-4 w-0.5 bg-slate-400"></div>
                        <div class="bg-blue-600 text-white text-[10px] px-2 py-0.5 rounded z-10 relative">ANDã‚²ãƒ¼ãƒˆ</div>
                        <div class="h-4 w-0.5 bg-slate-400"></div>
                        <div class="w-24 h-0.5 bg-slate-400"></div>
                        <div class="flex justify-between w-full gap-2">
                          <div class="flex flex-col items-center"><div class="h-3 w-0.5 bg-slate-400"></div><div class="bg-white border border-green-500 text-green-700 px-2 py-1 rounded text-[10px] text-center">åŸºæœ¬åŸå›  1</div></div>
                          <div class="flex flex-col items-center"><div class="h-3 w-0.5 bg-slate-400"></div><div class="bg-white border border-green-500 text-green-700 px-2 py-1 rounded text-[10px] text-center">åŸºæœ¬åŸå›  2</div></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-amber-500 hover:shadow-xl transition group">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-4xl">ğŸ§€</span>
                        <h3 class="font-bold text-2xl text-slate-800">4. ã‚¹ã‚¤ã‚¹ãƒãƒ¼ã‚ºãƒ¢ãƒ‡ãƒ«</h3>
                    </div>
                    <p class="text-slate-600 leading-relaxed mb-6">
                        <strong>ã‚¸ã‚§ãƒ¼ãƒ ã‚ºãƒ»ãƒªãƒ¼ã‚ºãƒ³ (James Reason)</strong> æå”±ã€‚å¤šå±¤ã®é˜²å¾¡å£ã«ã‚ã‚‹ã€Œç©´ã€ãŒé‡ãªã£ãŸã¨ãã«äº‹æ•…ã¯ç™ºç”Ÿã—ã¾ã™ã€‚
                    </p>
                    <div class="w-full overflow-hidden bg-slate-50 rounded-xl border border-slate-200 p-6 mb-6 flex justify-center">
                        <svg viewBox="0 0 800 320" class="w-full h-auto drop-shadow-sm">
                            <defs><marker id="arrowRed" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#EF4444" /></marker></defs>
                            <line x1="50" y1="140" x2="720" y2="140" stroke="#EF4444" stroke-width="4" stroke-dasharray="10,5" marker-end="url(#arrowRed)" />
                            <text x="50" y="120" font-family="sans-serif" font-size="14" font-weight="bold" fill="#EF4444">å±é™º (HAZARD)</text>
                            <g transform="translate(150, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#FEF3C7" stroke="#334155" stroke-width="2" /><circle cx="35" cy="100" r="15" fill="white" stroke="#EF4444" stroke-width="2" stroke-dasharray="4,2" /><text x="35" y="230" font-family="sans-serif" font-size="12" font-weight="bold" fill="#334155" text-anchor="middle">çµ„ç¹”</text></g>
                            <g transform="translate(300, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#FDE68A" stroke="#334155" stroke-width="2" /><circle cx="35" cy="100" r="15" fill="white" stroke="#EF4444" stroke-width="2" stroke-dasharray="4,2" /><text x="35" y="230" font-family="sans-serif" font-size="12" font-weight="bold" fill="#334155" text-anchor="middle">ç®¡ç†</text></g>
                            <g transform="translate(450, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#FCD34D" stroke="#334155" stroke-width="2" /><circle cx="35" cy="100" r="15" fill="white" stroke="#EF4444" stroke-width="2" stroke-dasharray="4,2" /><text x="35" y="230" font-family="sans-serif" font-size="12" font-weight="bold" fill="#334155" text-anchor="middle">å‰æ</text></g>
                            <g transform="translate(600, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#F59E0B" stroke="#334155" stroke-width="2" /><circle cx="35" cy="100" r="15" fill="white" stroke="#EF4444" stroke-width="2" stroke-dasharray="4,2" /><text x="35" y="230" font-family="sans-serif" font-size="12" font-weight="bold" fill="#334155" text-anchor="middle">è¡Œç‚º</text></g>
                            <g transform="translate(740, 140)"><path d="M0 -20 L5 -5 L20 0 L5 5 L0 20 L-5 5 L-20 0 L-5 -5 Z" fill="#EF4444" stroke="#991B1B" stroke-width="2" /><text x="0" y="40" font-family="sans-serif" font-size="14" font-weight="bold" fill="#EF4444" text-anchor="middle">æå¤±</text></g>
                        </svg>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-teal-500 hover:shadow-xl transition group">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-4xl">âš–ï¸</span>
                        <h3 class="font-bold text-2xl text-slate-800">5. æ­£å½“ãªæ–‡åŒ– (Just Culture)</h3>
                    </div>
                    <p class="text-slate-600 leading-relaxed mb-4">3ã¤ã®è¡Œå‹•ã‚’åŒºåˆ¥ã—ã€é©åˆ‡ã«ç®¡ç†ã—ã¾ã™ã€‚</p>
                    <div class="overflow-x-auto"><table class="w-full text-sm text-left text-slate-600 border border-slate-200 rounded-lg"><thead class="bg-slate-100 text-slate-700 font-bold"><tr><th class="p-2 border-b">è¡Œå‹•</th><th class="p-2 border-b">å¯¾å¿œ</th></tr></thead><tbody><tr class="border-b bg-green-50"><td class="p-2 font-bold text-green-700">ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã‚¨ãƒ©ãƒ¼</td><td class="p-2">æ…°ã‚ãƒ»æ”¯æ´</td></tr><tr class="border-b bg-yellow-50"><td class="p-2 font-bold text-yellow-700">ãƒªã‚¹ã‚¯è¡Œç‚º</td><td class="p-2">æŒ‡å°ãƒ»ã‚³ãƒ¼ãƒ</td></tr><tr class="bg-red-50"><td class="p-2 font-bold text-red-700">ç„¡è¬€ãªè¡Œç‚º</td><td class="p-2">å‡¦åˆ†</td></tr></tbody></table></div>
                </div>

                 <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-blue-500 hover:shadow-xl transition group">
                    <div class="flex items-center gap-3 mb-4"><span class="text-4xl">ğŸ“</span> <h3 class="font-bold text-2xl text-slate-800">6. äººé–“å·¥å­¦ (Human Factors)</h3></div>
                    <p class="text-slate-600 leading-relaxed mb-4">äººé–“ã‚’å¤‰ãˆã‚‹ã®ã§ã¯ãªãã€äººé–“ã®é™ç•Œã«åˆã‚ã›ã¦<strong>ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆ</strong>ã™ã‚‹ã“ã¨ã«æ³¨åŠ›ã—ã¾ã™ã€‚</p>
                    <div class="bg-blue-50 p-5 rounded-xl border border-blue-100 text-sm">
                        <strong class="text-blue-800 block mb-3 text-base">ä¸»è¦æˆ¦ç•¥ï¼š</strong>
                        <ul class="space-y-3">
                            <li class="flex items-start gap-3"><div class="bg-white p-1 rounded border border-blue-200 shadow-sm text-lg">ğŸ”’</div><div><strong class="text-slate-700">å¼·åˆ¶æ©Ÿèƒ½</strong><p class="text-slate-500 text-xs">èª¤ã‚Šä¸å¯èƒ½ãªè¨­è¨ˆï¼ˆä¾‹ï¼šç‰©ç†çš„ã«æ¥ç¶šã§ããªã„ç«¯å­ï¼‰ã€‚</p></div></li>
                            <li class="flex items-start gap-3"><div class="bg-white p-1 rounded border border-blue-200 shadow-sm text-lg">ğŸ“</div><div><strong class="text-slate-700">æ¨™æº–åŒ–</strong><p class="text-slate-500 text-xs">é…ç½®ã®ä¸€è²«æ€§ã«ã‚ˆã‚ŠèªçŸ¥è² è·ã‚’è»½æ¸›ã€‚</p></div></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-white rounded-3xl shadow-xl p-8 md:p-12 border border-slate-200">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                <div class="lg:col-span-5 space-y-6">
                    <h2 class="text-3xl font-bold text-slate-800">2. ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã¨ç¾çŠ¶è©•ä¾¡</h2>
                    <div class="h-1 w-20 bg-teal-500 rounded-full"></div>
                    <p class="text-slate-600 leading-relaxed font-light italic border-l-4 border-teal-500 pl-4 bg-teal-50/50 p-2 rounded-r-lg">
                        "<strong>AHRQ HSOPSC 2.0</strong> ã«åŸºã¥ãè©•ä¾¡ã€‚è‚¯å®šçš„å›ç­”ç‡(%)ã‚’å…¥åŠ›ã—ã€ç†æƒ³(100%)ã¨ã®ä¹–é›¢ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚"
                    </p>
                    
                    <div class="bg-slate-100 p-4 rounded-xl border border-slate-200 max-h-[500px] overflow-y-auto">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-3 tracking-wide flex items-center gap-2 sticky top-0 bg-slate-100 py-2 border-b"><span>ğŸšï¸</span> å„é …ç›®ã®ã‚¹ã‚³ã‚¢å…¥åŠ›</h4>
                        <div class="space-y-4 text-sm" id="assessmentControls"></div>
                    </div>

                    <div class="chart-container mt-6"><canvas id="assessmentChart"></canvas></div>
                </div>

                <div class="lg:col-span-7 space-y-6">
                    <h3 class="font-bold text-slate-700 border-l-4 border-teal-500 pl-4">ã‚®ãƒ£ãƒƒãƒ—åˆ†æã¨æ¨å¥¨ç­–</h3>
                    <div class="space-y-4">
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <div class="flex items-start gap-3"><div class="bg-red-100 text-red-600 p-2 rounded-lg font-bold text-xl">âš ï¸</div>
                                <div><h4 class="font-bold text-slate-800">éç½°å‰‡çš„ãªã‚¨ãƒ©ãƒ¼å¯¾å¿œ</h4><p class="text-sm text-slate-600 mt-1"><strong>èª²é¡Œï¼š</strong> å‡¦ç½°ã¸ã®ææ€–ãŒå ±å‘Šã‚’å¦¨ã’ã€ãƒªã‚¹ã‚¯ãŒæ½œåœ¨åŒ–ã—ã¦ã„ã‚‹ã€‚</p>
                                    <div class="mt-3 bg-white p-3 rounded border border-slate-200 text-sm"><strong class="text-teal-600">âœ… è§£æ±ºç­–ï¼š</strong><ul class="list-disc list-inside text-slate-500 mt-1"><li>ã€Œæ­£å½“ãªæ–‡åŒ–ã€ã®å°å…¥ã€‚</li><li>ä»£ç”¨ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½ã€‚</li></ul></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-8">
            <div class="text-center mb-12"><h2 class="text-3xl font-bold text-slate-800">3. å®Ÿæ–½ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h2><div class="h-1 w-20 bg-blue-500 mx-auto mt-4 rounded-full"></div></div>
            <div class="relative max-w-5xl mx-auto pl-8 md:pl-0" id="roadmapContainer"></div>
        </section>

    </main>

    <footer class="bg-slate-900 py-12 border-t border-slate-800 mt-12 text-center text-slate-400 text-sm">
        <p>ASEANè«¸å›½ã®åŒ»ç™‚ã®è³ªå‘ä¸Šã‚’ç›®æŒ‡ã™ASQuaã‚¤ãƒ‹ã‚·ã‚¢ãƒãƒ–ã€‚</p>
        <p>é–‹ç™ºè€…: Krittichat Kamjornpreecha & Wilasinee Kueankaew | Supported by Gemini</p>
    </footer>

    <script>
        // --- Core Gemini API Proxy ---
        async function callGemini(prompt) {
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) { throw error; }
        }

        // --- Assessment & Roadmaps Generation (Japanese) ---
        const assessmentLabels = ['ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯', 'äººå“¡é…ç½®ã¨æ¥­å‹™ãƒšãƒ¼ã‚¹', 'çµ„ç¹”å­¦ç¿’', 'ã‚¨ãƒ©ãƒ¼ã¸ã®å¯¾å¿œ', 'ä¸Šå¸ã®æ”¯æ´', 'ã‚¨ãƒ©ãƒ¼ã«é–¢ã™ã‚‹æ„æ€ç–é€š', 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹æ”¾æ€§', 'äº‹è±¡å ±å‘Šã®é »åº¦', 'ç®¡ç†å±¤ã®æ”¯æ´', 'äº¤æ¥ã¨æƒ…å ±äº¤æ›'];
        document.getElementById('assessmentControls').innerHTML = assessmentLabels.map((l, i) => `
            <div>
                <div class="flex justify-between mb-1"><label class="text-slate-700 font-semibold text-xs">${i+1}. ${l}</label><span id="val-${i}" class="text-teal-600 font-bold text-xs">0%</span></div>
                <input type="range" min="0" max="100" value="0" class="w-full h-2 bg-slate-300 rounded-lg accent-teal-500" oninput="updateChartData(${i}, this.value)">
            </div>`).join('');

        const roadmapData = [
            { phase: "ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼šä¿¡é ¼æ§‹ç¯‰", duration: "1-3ãƒ¶æœˆ", activities: ["çµŒå–¶å±¤ã«ã‚ˆã‚‹ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿæ–½", "éç½°å‰‡ãƒãƒªã‚·ãƒ¼ã®æ˜æ–‡åŒ–"] },
            { phase: "ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼šå ±å‘Šä½“åˆ¶ã®æ•´å‚™", duration: "4-6ãƒ¶æœˆ", activities: ["ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Šãƒ•ã‚©ãƒ¼ãƒ ã®ç°¡ç´ åŒ–", "ã‚°ãƒƒãƒ‰ãƒ»ã‚­ãƒ£ãƒƒãƒè³ã®å°å…¥"] },
            { phase: "ç¬¬3ãƒ•ã‚§ãƒ¼ã‚ºï¼šæŒç¶šçš„å­¦ç¿’", duration: "7ãƒ¶æœˆä»¥é™", activities: ["å®‰å…¨ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®å®šä¾‹åŒ–", "RCAæ‰‹æ³•ã®å®šç€"] }
        ];
        document.getElementById('roadmapContainer').innerHTML = roadmapData.map((r, i) => `
            <div class="relative grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                <div class="${i%2===0 ? 'md:text-right md:pr-12' : 'hidden md:block'} order-1">
                    ${i%2===0 ? `<div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-teal-500">
                        <h3 class="text-xl font-bold text-teal-700">${r.phase}</h3><span class="text-xs font-bold text-slate-400 uppercase">${r.duration}</span>
                        <ul class="text-sm text-slate-600 mt-3 space-y-2">${r.activities.map(a => `<li>ğŸ”¹ ${a}</li>`).join('')}</ul>
                    </div>` : ''}
                </div>
                <div class="absolute left-0 md:left-1/2 -translate-x-1/2 top-6 w-10 h-10 bg-blue-500 rounded-full border-4 border-white shadow-md z-10 flex items-center justify-center text-white font-bold">${i+1}</div>
                <div class="${i%2!==0 ? 'md:pl-12' : 'hidden md:block'} order-2">
                    ${i%2!==0 ? `<div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-500">
                        <h3 class="text-xl font-bold text-blue-700">${r.phase}</h3><span class="text-xs font-bold text-slate-400 uppercase">${r.duration}</span>
                        <ul class="text-sm text-slate-600 mt-3 space-y-2">${r.activities.map(a => `<li>ğŸ”¹ ${a}</li>`).join('')}</ul>
                    </div>` : ''}
                </div>
            </div>`).join('');

        const ctx = document.getElementById('assessmentChart').getContext('2d');
        const assessmentChart = new Chart(ctx, {
            type: 'bar',
            data: { labels: assessmentLabels, datasets: [{ label: 'ç¾åœ¨ã®ã‚¹ã‚³ã‚¢', data: Array(10).fill(0), backgroundColor: '#0D9488' }, { label: 'ç†æƒ³ç›®æ¨™ (100%)', data: Array(10).fill(100), backgroundColor: '#E2E8F0' }] },
            options: { indexAxis: 'y', scales: { x: { max: 100 } } }
        });
        function updateChartData(i, v) { document.getElementById(`val-${i}`).innerText = v + '%'; assessmentChart.data.datasets[0].data[i] = v; assessmentChart.update(); }

        // --- AI Analysis Logic ---
        async function startFullAnalysis() {
            const input = document.getElementById('scenarioInput').value;
            const btn = document.getElementById('combinedRunButton');
            const spinner = document.getElementById('runSpinner');
            const rcaDiv = document.getElementById('analyzeResult');
            const pInput = document.getElementById('planInput');
            const pDiv = document.getElementById('planResult');

            if (!input.trim()) return alert("ã‚·ãƒŠãƒªã‚ªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            btn.disabled = true; spinner.classList.remove('hidden');
            pInput.value = 'æ—¥æœ¬èªã§è©³ç´°åˆ†æã¨è¨ˆç”»ã‚’ä½œæˆã—ã¦ã„ã¾ã™...';

            try {
                // STEP 1: RCA Japanese
                const rcaPrompt = `åŒ»ç™‚å®‰å…¨ã®å°‚é–€å®¶ã¨ã—ã¦ä»¥ä¸‹ã®äº‹ä¾‹ã‚’RCAåˆ†æã—ã¦ãã ã•ã„ï¼š "${input}"ã€‚
                å¿…ãšã€æ—¥æœ¬èªï¼ˆæ•¬ä½“ï¼‰ã€‘ã§å‡ºåŠ›ã€‚HTMLã®ã¿ï¼ˆMarkdownä¸å¯ï¼‰ã€‚
                1.äº‹è±¡è¦ç´„(h3) 2.æ™‚ç³»åˆ— 3.é­šéª¨å›³(fishbone-cardæ§‹é€ ) 4.ãªãœãªãœåˆ†æ(why-stepæ§‹é€ ) 5.ã‚¹ã‚¤ã‚¹ãƒãƒ¼ã‚º(rca-table)`;
                const rcaHtml = (await callGemini(rcaPrompt)).replace(/```html/g,'').replace(/```/g,'');
                rcaDiv.innerHTML = rcaHtml; rcaDiv.classList.remove('hidden');

                // STEP 2: Action Plan Japanese
                pInput.value = 'åˆ†æå®Œäº†ã€‚æ”¹å–„è¨ˆç”»ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...';
                const pPrompt = `åˆ†æçµæœ "${rcaHtml}" ã«åŸºã¥ãã€æ”¹å–„è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                å¿…ãšã€æ—¥æœ¬èªï¼ˆæ•¬ä½“ï¼‰ã€‘ã§å‡ºåŠ›ã€‚1.PDSAè¡¨(action-table) 2.è©³ç´°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ 3.çµè«–`;
                const pHtml = (await callGemini(pPrompt)).replace(/```html/g,'').replace(/```/g,'');
                pDiv.innerHTML = pHtml; pDiv.classList.remove('hidden');
                pInput.value = 'âœ” è§£æã¨è¨ˆç”»ã®ä½œæˆãŒæˆåŠŸã—ã¾ã—ãŸ';
                pDiv.scrollIntoView({ behavior: 'smooth' });
            } catch (e) { alert("ã‚¨ãƒ©ãƒ¼: " + e.message); }
            finally { btn.disabled = false; spinner.classList.add('hidden'); }
        }

        function exportToWord() {
            const html = `<html><body style="font-family:sans-serif;">${document.getElementById('planResult').innerHTML}</body></html>`;
            const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'RCA_æ”¹å–„è¨ˆç”»å ±å‘Šæ›¸.doc'; link.click();
        }
    </script>
</body>
</html>
