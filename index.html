<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%E2%9C%A8%3C/text%3E%3C/svg%3E">
    <title>RCA ã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ»ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ (Insight Companion)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #F8FAFC;
            color: #334155;
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 300px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 500px; 
            }
        }

        .rca-table, .action-table, .initiative-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .rca-table th, .action-table th, .initiative-table th {
            color: white;
            padding: 10px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        .rca-table th { background-color: #F59E0B; }
        .action-table th { background-color: #0EA5E9; }
        .initiative-table th { background-color: #7C3AED; }
        .rca-table td, .action-table td, .initiative-table td {
            border: 1px solid #e2e8f0;
            padding: 10px;
            vertical-align: top;
        }
        tr:nth-child(even) { background-color: #f8fafc; }

        .fishbone-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        @media (min-width: 768px) {
            .fishbone-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .fishbone-card {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .fishbone-header {
            font-weight: bold;
            color: #475569;
            border-bottom: 2px solid #cbd5e1;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .why-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            position: relative;
        }
        .why-number {
            background-color: #EC4899; 
            color: white;
            font-weight: bold;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.75rem;
            margin-right: 0.75rem;
            flex-shrink: 0;
            z-index: 10;
        }
        .why-line {
            position: absolute;
            left: 11px;
            top: 24px;
            bottom: -10px;
            width: 2px;
            background-color: #FBCFE8; 
            z-index: 0;
        }
        .why-step:last-child .why-line {
            display: none;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #0EA5E9;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-slate-50">
    <header class="relative w-full h-64 bg-gradient-to-r from-slate-800 to-slate-900 shadow-xl overflow-hidden mb-8 flex items-center justify-center">
      <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
        <div class="absolute top-10 left-10 w-64 h-64 bg-teal-500 rounded-full filter blur-3xl"></div>
        <div class="absolute bottom-10 right-10 w-64 h-64 bg-blue-500 rounded-full filter blur-3xl"></div>
      </div>
    
      <div class="relative z-10 text-center px-4 md:px-20 mt-4">
        <h1 class="text-white font-bold text-xs md:text-sm lg:text-base leading-relaxed tracking-wide shadow-black drop-shadow-md">
          è³ªã®æ ¼å·®ã‚’åŸ‹ã‚ã‚‹ï¼šã‚¢ã‚¸ã‚¢6ã‹å›½ã®åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹AIæ´»ç”¨RCAãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã®è©•ä¾¡<br>
          <span class="text-slate-300 font-medium">â€“ ã‚¿ã‚¤ã€å°æ¹¾ã€ãƒŸãƒ£ãƒ³ãƒãƒ¼ã€ãƒãƒ¬ãƒ¼ã‚·ã‚¢ã€ãƒ–ãƒ«ãƒã‚¤ã€ãƒ•ã‚£ãƒªãƒ”ãƒ³ã®å…±åŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â€“</span>
        </h1>
      </div>
    
      <div class="absolute top-6 right-6 flex items-center gap-4 z-20">            
        <div class="flex gap-2">
          <img src="https://flagcdn.com/h40/th.png" alt="Thailand" class="h-6 rounded shadow-lg">
          <img src="https://flagcdn.com/h40/tw.png" alt="Taiwan" class="h-6 rounded shadow-lg">
          <img src="https://flagcdn.com/h40/mm.png" alt="Myanmar" class="h-6 rounded shadow-lg">
          <img src="https://flagcdn.com/h40/ph.png" alt="Philippines" class="h-6 rounded shadow-lg">
          <img src="https://flagcdn.com/h40/my.png" alt="Malaysia" class="h-6 rounded shadow-lg">
          <img src="https://flagcdn.com/h40/bn.png" alt="Brunei" class="h-6 rounded shadow-lg">
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 -mt-20 pb-16 space-y-24 max-w-screen-2xl relative z-20">

        <section id="ai-lab">
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 rounded-3xl p-1 shadow-2xl overflow-hidden transform hover:scale-[1.01] transition-transform duration-300">
                <div class="bg-white rounded-[20px] p-6 md:p-10">
                    <div class="text-center mb-10">
                        <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ã‚µãƒãƒ¼ãƒˆ</span>
                        <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800 mt-4 mb-2 flex items-center justify-center gap-3">
                            <span>âœ¨</span> RCA ã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ»ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³
                        </h2>
                        <p class="text-slate-500 max-w-2xl mx-auto">
                            æ·±ã„å­¦ç¿’ã€æ ¹æœ¬åŸå› åˆ†æã€ãã—ã¦ã‚ˆã‚Šå®‰å…¨ãªã‚·ã‚¹ãƒ†ãƒ ã®å…±å‰µã‚’æ”¯æ´ã™ã‚‹å°‚é–€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€‚
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                        <div class="space-y-6">
                            <div class="bg-slate-50 rounded-2xl p-6 border border-slate-200 shadow-sm hover:shadow-md transition duration-300">
                                <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center gap-2">
                                    <span class="text-2xl">ğŸ¥</span> 1. ç—…é™¢ãƒªã‚¹ã‚¯ãƒ»ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Š
                                </h3>
                                <p class="text-xs text-slate-500 mb-3">äº‹è±¡ã®çµŒéã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚æ ¹æœ¬åŸå› ã®å¯è¦–åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
                                <textarea id="scenarioInput" class="w-full p-4 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-amber-500 outline-none transition shadow-inner mb-4 bg-white" rows="6" placeholder="ä¾‹ï¼šåŒ…è£…ã®é¡ä¼¼ã¨éåº¦ãªæ¥­å‹™é‡ã«ã‚ˆã‚Šã€çœ‹è­·å¸«ãŒèª¤ã£ãŸè–¬å‰¤ã‚’æŠ•ä¸ã—ãŸ..."></textarea>
                                
                                <button id="combinedRunButton" onclick="startFullAnalysis()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition shadow-lg flex justify-center items-center gap-2 transform active:scale-95">
                                    <span id="runSpinner" class="loader hidden border-white border-t-green-800"></span>
                                    <span>ğŸ” æ ¹æœ¬åŸå› åˆ†æ (RCA) ã‚’å®Ÿè¡Œ</span>
                                </button>

                                <div class="mt-4 rounded-xl border border-amber-100 bg-white shadow-inner overflow-hidden">
                                  <div id="analyzeResult" class="hidden p-4 text-sm text-slate-700 overflow-x-auto"></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 rounded-2xl p-6 border-2 border-blue-100 shadow-md relative overflow-hidden h-full">
                            <div class="absolute top-0 right-0 bg-blue-200 text-blue-800 text-[10px] font-bold px-2 py-1 rounded-bl-lg">ã‚¹ãƒ†ãƒƒãƒ— 2 (è‡ªå‹•ç”Ÿæˆ)</div>
                            <h3 class="text-lg font-bold text-blue-900 mb-3 flex items-center gap-2">
                                <span class="text-2xl">ğŸ¯</span> 2. ãƒªã‚¹ã‚¯åˆ†æã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
                            </h3>
                            <p class="text-xs text-blue-700 mb-4">PDSAã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã€æ”¹å–„ç­–ã€ãŠã‚ˆã³çµè«–ãƒ»æè¨€ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</p>
                            <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ï¼š</label>
                            <textarea id="planInput" class="w-full p-4 border border-blue-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none h-24 bg-white mb-4 shadow-inner font-mono text-slate-600" placeholder="åˆ†æçµæœã‚’å¾…æ©Ÿä¸­..." readonly></textarea>
                            <div class="flex gap-2">
                                <button onclick="exportToWord()" class="w-full bg-white hover:bg-slate-50 text-blue-700 border border-blue-200 font-bold py-3 px-4 rounded-xl transition shadow-md flex justify-center items-center gap-2 transform active:scale-95">
                                    <span class="text-lg">ğŸ“„</span>
                                    <span class="md:inline">Wordãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‡ºåŠ›</span>
                                </button>
                            </div>

                            <div class="mt-6 rounded-xl border border-blue-100 bg-white shadow-lg overflow-hidden">
                              <div id="planResult" class="hidden p-5 text-sm text-slate-700 min-h-[100px] overflow-x-auto"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-800">1. ã‚³ã‚¢ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®è©³ç´°è§£èª¬</h2>
                <div class="h-1 w-20 bg-teal-500 mx-auto mt-4 rounded-full"></div>
                <p class="text-slate-600 mt-4 max-w-3xl mx-auto">åŒ»ç™‚å®‰å…¨ã®6ã¤ã®æŸ±ã‚’ç†è§£ã—ã€äº‹æ•…ã‚’ã‚·ã‚¹ãƒ†ãƒ çš„ã«äºˆé˜²ã—ã¾ã™ã€‚</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-cyan-500">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-4xl">ğŸŸ</span>
                        <h3 class="font-bold text-2xl text-slate-800">1. é­šéª¨å›³ (çŸ³å·å›³)</h3>
                    </div>
                    <div class="w-full overflow-hidden bg-slate-50 rounded-xl border border-slate-200 p-2 mb-4 flex justify-center">
                        <svg viewBox="0 0 800 350" class="w-full h-auto">
                            <line x1="50" y1="175" x2="650" y2="175" stroke="#334155" stroke-width="4" />
                            <polygon points="650,130 790,175 650,220" fill="#0EA5E9" />
                            <text x="705" y="172" font-size="16" font-weight="bold" fill="white" text-anchor="middle">å•é¡Œ</text>
                            <line x1="150" y1="50" x2="200" y2="175" stroke="#64748B" stroke-width="2" />
                            <text x="150" y="40" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">äºº (Man)</text>
                            <line x1="350" y1="50" x2="400" y2="175" stroke="#64748B" stroke-width="2" />
                            <text x="350" y="40" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">æ©Ÿ (Machine)</text>
                            <line x1="550" y1="50" x2="600" y2="175" stroke="#64748B" stroke-width="2" />
                            <text x="550" y="40" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">æ³• (Method)</text>
                            <line x1="150" y1="300" x2="200" y2="175" stroke="#64748B" stroke-width="2" />
                            <text x="150" y="320" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">æ–™ (Material)</text>
                            <line x1="450" y1="300" x2="500" y2="175" stroke="#64748B" stroke-width="2" />
                            <text x="460" y="320" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">ç’° (Environment)</text>
                        </svg>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-lg border-t-4 border-amber-500">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-4xl">ğŸ§€</span>
                        <h3 class="font-bold text-2xl text-slate-800">4. ã‚¹ã‚¤ã‚¹ãƒãƒ¼ã‚ºãƒ¢ãƒ‡ãƒ«</h3>
                    </div>
                    <div class="w-full overflow-hidden bg-slate-50 rounded-xl border border-slate-200 p-6 mb-6 flex justify-center">
                        <svg viewBox="0 0 800 320" class="w-full h-auto">
                            <line x1="50" y1="140" x2="720" y2="140" stroke="#EF4444" stroke-width="4" stroke-dasharray="10,5" />
                            <g transform="translate(150, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#FEF3C7" stroke="#334155" stroke-width="2" /><text x="35" y="230" font-size="12" font-weight="bold" text-anchor="middle">çµ„ç¹”</text></g>
                            <g transform="translate(300, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#FDE68A" stroke="#334155" stroke-width="2" /><text x="35" y="230" font-size="12" font-weight="bold" text-anchor="middle">ç®¡ç†</text></g>
                            <g transform="translate(450, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#FCD34D" stroke="#334155" stroke-width="2" /><text x="35" y="230" font-size="12" font-weight="bold" text-anchor="middle">ç¾å ´</text></g>
                            <g transform="translate(600, 40)"><rect x="0" y="0" width="70" height="200" rx="4" fill="#F59E0B" stroke="#334155" stroke-width="2" /><text x="35" y="230" font-size="12" font-weight="bold" text-anchor="middle">è¡Œç‚º</text></g>
                        </svg>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-white rounded-3xl shadow-xl p-8 md:p-12 border border-slate-200">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                <div class="lg:col-span-5 space-y-6">
                    <h2 class="text-3xl font-bold text-slate-800">2. ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã¨ç¾çŠ¶è©•ä¾¡</h2>
                    <div id="assessmentControls" class="bg-slate-100 p-4 rounded-xl max-h-[500px] overflow-y-auto space-y-4"></div>
                </div>
                <div class="lg:col-span-7">
                    <div class="chart-container"><canvas id="assessmentChart"></canvas></div>
                </div>
            </div>
        </section>

        <section class="py-8">
            <div class="text-center mb-12"><h2 class="text-3xl font-bold text-slate-800">3. å®Ÿæ–½ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h2><div class="h-1 w-20 bg-blue-500 mx-auto mt-4 rounded-full"></div></div>
            <div class="relative max-w-5xl mx-auto pl-8 md:pl-0" id="roadmapContainer"></div>
        </section>

    </main>

    <footer class="bg-slate-900 py-12 text-center text-slate-400 text-sm">
        <p>ASQua åŒ»ç™‚å®‰å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | Saga AI ã‚µãƒãƒ¼ãƒˆ</p>
    </footer>

    <script>
        // --- Core Functions ---
        async function callGemini(prompt) {
            const res = await fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });
            const data = await res.json();
            return data.candidates[0].content.parts[0].text;
        }

        async function startFullAnalysis() {
            const input = document.getElementById('scenarioInput').value;
            const btn = document.getElementById('combinedRunButton');
            const spinner = document.getElementById('runSpinner');
            const resDiv = document.getElementById('analyzeResult');
            const pInput = document.getElementById('planInput');
            const pResDiv = document.getElementById('planResult');

            if (!input.trim()) return alert("ã‚·ãƒŠãƒªã‚ªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

            btn.disabled = true; spinner.classList.remove('hidden');
            pInput.value = 'æ—¥æœ¬èªã§åˆ†æä¸­...';

            try {
                // STEP 1: RCA
                const rcaPrompt = `åŒ»ç™‚å®‰å…¨ç®¡ç†è€…ã¨ã—ã¦ã€ä»¥ä¸‹ã®äº‹ä¾‹ã‚’RCAåˆ†æã—ã¦ãã ã•ã„ï¼š "${input}"ã€‚å¿…ãšã€æ—¥æœ¬èªï¼ˆæ•¬ä½“ï¼‰ã€‘ã§å‡ºåŠ›ã€‚Markdownä¸å¯ã€HTMLã‚¿ã‚°ã®ã¿ä½¿ç”¨ã€‚1.äº‹è±¡è¦ç´„(h3) 2.æ™‚ç³»åˆ— 3.é­šéª¨å›³(fishbone-cardæ§‹é€ ) 4.ãªãœãªãœåˆ†æ(why-stepæ§‹é€ ) 5.ã‚¹ã‚¤ã‚¹ãƒãƒ¼ã‚ºåˆ†æ(rca-table)`;
                const rcaHtml = (await callGemini(rcaPrompt)).replace(/```html/g,'').replace(/```/g,'');
                resDiv.innerHTML = rcaHtml; resDiv.classList.remove('hidden');

                // STEP 2: Action Plan (Forced Table)
                pInput.value = 'æ”¹å–„è¨ˆç”»ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆä¸­...';
                const pPrompt = `ä»¥ä¸‹ã®RCAåˆ†æã«åŸºã¥ãã€åŒ»ç™‚å®‰å…¨æ”¹å–„è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š "${rcaHtml}"
                å¿…ãšã€æ—¥æœ¬èªï¼ˆæ•¬ä½“ï¼‰ã€‘ã§å‡ºåŠ›ã—ã€HTMLå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯( \`\`\` )ã¯çµ¶å¯¾ã«ä½¿ã‚ãªã„ã§ãã ã•ã„ã€‚

                ä»¥ä¸‹ã®æ§‹æˆã‚’å³å®ˆã—ã¦ãã ã•ã„ï¼š
                1. <h3>1. PDSAæˆ¦ç•¥ã‚µãƒãƒªãƒ¼</h3>
                <table class="action-table">
                    <thead><tr><th>é …ç›®</th><th>å†…å®¹</th></tr></thead>
                    <tbody>
                        <tr><td>ç›®æ¨™</td><td>...</td></tr>
                        <tr><td>Plan (è¨ˆç”»)</td><td>...</td></tr>
                        <tr><td>Do (å®Ÿè¡Œ)</td><td>...</td></tr>
                        <tr><td>Study (å­¦ç¿’)</td><td>...</td></tr>
                        <tr><td>Act (æ”¹å–„)</td><td>...</td></tr>
                    </tbody>
                </table>

                2. <h3>2. è©³ç´°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³</h3>
                <table class="action-table">
                    <thead><tr><th>ç›®æ¨™</th><th>ã‚¹ãƒ†ãƒƒãƒ—</th><th>KPI</th><th>è²¬ä»»è€…</th><th>æœŸé™</th></tr></thead>
                    <tbody><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr></tbody>
                </table>

                3. <h3>3. çµè«–ã¨æè¨€</h3>
                (ç®‡æ¡æ›¸ãã§è¨˜è¿°)`;

                const pHtml = (await callGemini(pPrompt)).replace(/```html/g,'').replace(/```/g,'');
                pResDiv.innerHTML = pHtml; pResDiv.classList.remove('hidden');
                pInput.value = 'âœ” è§£æã¨è¨ˆç”»ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ';
                pResDiv.scrollIntoView({ behavior: 'smooth' });

            } catch (e) { alert("ã‚¨ãƒ©ãƒ¼: " + e.message); }
            finally { btn.disabled = false; spinner.classList.add('hidden'); }
        }

        // --- UI Setup ---
        const items = ['ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯', 'äººå“¡é…ç½®', 'çµ„ç¹”å­¦ç¿’', 'ã‚¨ãƒ©ãƒ¼å¯¾å¿œ', 'ä¸Šå¸æ”¯æ´', 'æ„æ€ç–é€š', 'é–‹æ”¾æ€§', 'å ±å‘Šé »åº¦', 'çµŒå–¶å±¤æ”¯æ´', 'æƒ…å ±ä¼é”'];
        document.getElementById('assessmentControls').innerHTML = items.map((t, i) => `
            <div>
                <div class="flex justify-between text-xs font-bold mb-1"><label>${t}</label><span id="v-${i}">0%</span></div>
                <input type="range" min="0" max="100" value="0" class="w-full h-2 bg-slate-300 rounded-lg accent-teal-600" oninput="upd(${i}, this.value)">
            </div>
        `).join('');

        const ctx = document.getElementById('assessmentChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: { labels: items, datasets: [{ label: 'ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ (%)', data: Array(10).fill(0), backgroundColor: '#0D9488' }, { label: 'ç†æƒ³ (100%)', data: Array(10).fill(100), backgroundColor: '#E2E8F0' }] },
            options: { indexAxis: 'y', scales: { x: { max: 100 } } }
        });

        function upd(i, v) { document.getElementById(`v-${i}`).innerText = v + '%'; chart.data.datasets[0].data[i] = v; chart.update(); }

        const roadmapData = [
            { phase: "ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼šä¿¡é ¼æ§‹ç¯‰", duration: "1-3ãƒ¶æœˆ", activities: ["çµŒå–¶å±¤ã«ã‚ˆã‚‹ãƒ©ã‚¦ãƒ³ãƒ‰", "éç½°å‰‡ãƒãƒªã‚·ãƒ¼æ˜æ–‡åŒ–"] },
            { phase: "ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼šå ±å‘Šä½“åˆ¶ã®æ•´å‚™", duration: "4-6ãƒ¶æœˆ", activities: ["å ±å‘Šãƒ•ã‚©ãƒ¼ãƒ ã®ç°¡ç´ åŒ–", "ã‚°ãƒƒãƒ‰ãƒ»ã‚­ãƒ£ãƒƒãƒè³å°å…¥"] },
            { phase: "ç¬¬3ãƒ•ã‚§ãƒ¼ã‚ºï¼šæŒç¶šçš„å­¦ç¿’", duration: "7ãƒ¶æœˆä»¥é™", activities: ["å®‰å…¨ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹å®šä¾‹åŒ–", "RCAæ‰‹æ³•ã®å®šç€"] }
        ];
        document.getElementById('roadmapContainer').innerHTML = roadmapData.map((r, i) => `
            <div class="relative grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                <div class="${i%2===0 ? 'md:text-right md:pr-12' : 'hidden md:block'} order-1">
                    ${i%2===0 ? `<div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-teal-500">
                        <h3 class="text-xl font-bold text-teal-700">${r.phase}</h3><span class="text-xs font-bold text-slate-400">${r.duration}</span>
                        <ul class="text-sm text-slate-600 mt-3 space-y-2">${r.activities.map(a => `<li>ğŸ”¹ ${a}</li>`).join('')}</ul>
                    </div>` : ''}
                </div>
                <div class="absolute left-0 md:left-1/2 -translate-x-1/2 top-6 w-10 h-10 bg-blue-500 rounded-full border-4 border-white z-10 flex items-center justify-center text-white font-bold">${i+1}</div>
                <div class="${i%2!==0 ? 'md:pl-12' : 'hidden md:block'} order-2">
                    ${i%2!==0 ? `<div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-500">
                        <h3 class="text-xl font-bold text-blue-700">${r.phase}</h3><span class="text-xs font-bold text-slate-400">${r.duration}</span>
                        <ul class="text-sm text-slate-600 mt-3 space-y-2">${r.activities.map(a => `<li>ğŸ”¹ ${a}</li>`).join('')}</ul>
                    </div>` : ''}
                </div>
            </div>`).join('');

        function exportToWord() {
            const html = `<html><meta charset="utf-8"><body>${document.getElementById('planResult').innerHTML}</body></html>`;
            const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'åŒ»ç™‚å®‰å…¨æ”¹å–„è¨ˆç”»æ›¸.doc'; link.click();
        }
    </script>
</body>
</html>
